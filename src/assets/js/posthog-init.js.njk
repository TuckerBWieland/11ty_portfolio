---
permalink: /assets/js/posthog-init.js
eleventyExcludeFromCollections: true
---

(function () {
  if (typeof window === 'undefined') return;

  // ✅ Official PostHog loader (UNMODIFIED)
  {% raw %}!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){
    function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){
      t.push([e].concat(Array.prototype.slice.call(arguments,0)))
    }}
    (p=t.createElement("script")).type="text/javascript"; p.async=!0;
    // Load the client through our proxy (the loader URL will be re-pointed by api_host when init runs)
    p.src=(s && s.api_host ? s.api_host : "https://us.i.posthog.com") + "/static/array.js";
    (r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);
    var u=e; void 0!==a ? u=e[a]=[] : a="posthog"; u.people=u.people||[];
    u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e};
    u.people.toString=function(){return u.toString(1)+".people (stub)"};
    o="capture identify alias people.set people.set_once people.unset register register_once unregister set_config reset opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing on isFeatureEnabled reloadFeatureFlags group groupIdentify".split(" ");
    for(n=0;n<o.length;n++)g(u,o[n]);
    e._i.push([i,s,a])
  },e.__SV=1)}(document,window.posthog||[]);{% endraw %}

  // Pull the token at build time; it must start with phc_
  const KEY = '{{ process.env.POSTHOG_KEY or "" }}';
  if (!KEY || typeof KEY !== 'string' || KEY.trim() === '') { 
    console.log("ℹ️ PostHog skipped: no POSTHOG_KEY at build"); 
    return; 
  }
  if (!KEY.startsWith('phc_')) { 
    console.error("❌ POSTHOG_KEY must start with 'phc_'"); 
    return; 
  }

  // ✅ Init with token as the first positional arg, options second
  try {
    window.posthog.init(KEY, {
      api_host: 'https://logs.tuckerwieland.com',
      ui_host: 'https://us.posthog.com',
      autocapture: true,
      capture_pageview: true,
      capture_pageleave: true
    });

    // Quick sanity event so Live shows something immediately
    window.posthog.capture('$pageview');
  } catch (error) {
    console.warn('PostHog initialization failed:', error);
  }
})();