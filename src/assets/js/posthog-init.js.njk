---
permalink: /assets/js/posthog-init.js
eleventyExcludeFromCollections: true
---
/**
 * PostHog init with reverse proxy
 * - Loads array.js from our proxy (api_host)
 * - Initializes only when POSTHOG_KEY is present
 * - Guards against double-initialization
 */

(function () {
  if (typeof window === 'undefined') return;

  // Avoid double init if script is included twice
  if (window.posthog && window.posthog.__LOADED__) {
    console.info('‚ÑπÔ∏è PostHog already loaded; skipping re-init');
    return;
  }

  // Lightweight loader (fetched from our proxy instead of posthog.com)
  !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){
    function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){
      t.push([e].concat(Array.prototype.slice.call(arguments,0)))
    }}
    (p=t.createElement("script")).type="text/javascript";
    p.async=!0;
    // Always load array.js from our proxy (Cloudflare will forward upstream)
    var host = (s && s.api_host) ? s.api_host : "https://logs.tuckerwieland.com";
    p.src = host.replace(/\/+$/,'') + "/static/array.js";
    (r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);
    var u=e;
    void 0!==a ? u=e[a]=[] : a="posthog";
    u.people=u.people||[];
    u.toString=function(t){var e="posthog";return "posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e};
    u.people.toString=function(){return u.toString(1)+".people (stub)"};
    var c="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags reloadFeatureFlags group groupIdentify".split(" ");
    for(var i=0;i<c.length;i++)g(u,c[i]);
    e._i.push([i,s,a])
  }, e.__SV=1)}(document,window.posthog||{});

  // Initialize PostHog after SDK loads
  var key = 'phc_TiV9pa7UYwvzOxJcVNO6kXQYhpKQNQPTdKzZKEKFBqU';
  console.log('üöÄ Initializing PostHog with key:', key.slice(0, 8) + '... (v3)');
  
  window.posthog.init(key, {
    api_host: 'https://logs.tuckerwieland.com',
    ui_host: 'https://us.posthog.com',
    persistence: 'localStorage+cookie',
    capture_pageview: true,
    loaded: function(posthog) {
      console.log('‚úÖ PostHog loaded via proxy');
    }
  });
})();
