---
permalink: /assets/js/posthog-init.js
eleventyExcludeFromCollections: true
---

/* Minimal, proxy-safe PostHog bootstrap */
(function(doc, win) {
  if (!("{{ process.env.POSTHOG_KEY }}")) {
    console.log("‚ÑπÔ∏è PostHog skipped: no POSTHOG_KEY at build");
    return;
  }

  var ph = win.posthog = win.posthog || [];
  ph._i = ph._i || [];
  ph.init = function(token, cfg, name) {
    function stub(target, method){
      target[method] = function(){ target.push([method].concat([].slice.call(arguments,0))) }
    }
    var instance = name ? ph[name] = [] : ph;
    var methods = "init capture identify alias people.set people.set_once reset group.set register unregister autotrack set_config capture_links capture_forms time_event".split(" ");
    for (var i=0; i<methods.length; i++) stub(instance, methods[i]);

    // Load array.js from your proxy
    var s = doc.createElement("script");
    s.type = "text/javascript";
    s.async = true;
    s.crossOrigin = "anonymous";
    s.src = "https://logs.tuckerwieland.com/static/array.js";
    var x = doc.getElementsByTagName("script")[0];
    x.parentNode.insertBefore(s, x);

    instance._i.push([token, cfg, name]);
  };

  console.log("üöÄ Initializing PostHog with key:", "{{ process.env.POSTHOG_KEY }}", "(v2)");

  ph.init("{{ process.env.POSTHOG_KEY }}", {
    api_host: "https://logs.tuckerwieland.com",
    // never put `token:` here
    ui_host: "https://us.posthog.com",
    capture_pageview: true,
    person_profiles: "identified_only"
  });

  console.log("‚úÖ PostHog loaded via proxy");
})(document, window);